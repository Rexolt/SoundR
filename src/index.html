<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SoundR</title>


  <style>
    @font-face {
      font-family: 'Sixtyfour';
      src: url('assets/fonts/Sixtyfour-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
  </style>


  <link id="google-font-sixtyfour" 
        href="https://fonts.googleapis.com/css2?family=Sixtyfour&display=swap" 
        rel="stylesheet" 
        disabled="disabled" 
        />

  <style>
  
    * {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
    }
    :root {
      --bg-color: #101010;
      --text-color: #f0f0f0;
      --transition-speed: 0.3s;
      --header-font: 'Sixtyfour', cursive, sans-serif; /* Az intró és a SoundR felirat */
      --body-font: Arial, sans-serif;                  /* A többi tartalom */
    }
    body {
      background: var(--bg-color);
      color: var(--text-color);
      transition: background-color var(--transition-speed), color var(--transition-speed);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      font-family: var(--body-font);
    }
    body.animations-off * {
      transition: none !important;
      animation: none !important;
    }
    body.light {
      --bg-color: #ffffff;
      --text-color: #000000;
    }
    body.dark {
      --bg-color: #101010;
      --text-color: #f0f0f0;
    }

    
    #offline-indicator {
      position: absolute;
      top: 10px;
      left: 10px;
      display: none; 
      z-index: 9999;
    }
    body.offline #offline-indicator {
      display: block;
    }
    #offline-indicator img {
      width: 30px;
      height: 30px;
    }


    #intro-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #101010; display: flex; align-items: center; justify-content: center;
      z-index: 9999; opacity: 1; transition: opacity 1s ease;
      font-family: var(--header-font); 
    }
    #intro-overlay.hide {
      opacity: 0; pointer-events: none;
    }
    #intro-text {
      font-size: 4rem; 
      color: #fff; 
      letter-spacing: 3px;
      border-right: 0.15em solid orange; 
      white-space: nowrap; 
      overflow: hidden;
      width: 0ch;
      animation: 
        typing 2.5s steps(6, end) forwards,
        blink 0.75s step-end infinite alternate,
        floatToTop 1s ease 3s forwards;
    }
    @keyframes typing {
      from { width: 0ch; }
      to   { width: 7ch; } 
    }
    @keyframes blink {
      50% { border-color: transparent; }
    }
    @keyframes floatToTop {
      0%   { transform: translateY(0); }
      100% { transform: translateY(-170px); }
    }


    header {
      background: linear-gradient(45deg, rgba(255,255,255,0.05), rgba(255,255,255,0.15));
      backdrop-filter: blur(8px);
      padding: 20px;
      text-align: center;
      font-size: 1.6rem;
      border-bottom: 1px solid #333;
      letter-spacing: 1px;
      color: #fff;
      position: relative;
      flex-shrink: 0;
      font-family: var(--header-font);
    }
    #header-title {
      margin: 0;
      font-weight: normal;
      font-size: 2rem;
    }
    #discord-btn, #support-btn {
      position: absolute; top: 20px;
      background: rgba(255,255,255,0.2);
      border: none;
      color: #fff;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      transition: background 0.2s, transform 0.2s;
    }
    #discord-btn:hover, #support-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }
    #support-btn { right: 130px; }
    #discord-btn { right: 20px; }


    main {
      flex: 1;
      display: flex;
      overflow: hidden;
      font-family: var(--body-font);
    }
    nav {
      min-width: 220px;
      background: rgba(255,255,255,0.03);
      border-right: 1px solid #333;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      padding: 10px;
      backdrop-filter: blur(12px);
    }
    nav button {
      background: rgba(255,255,255,0.05);
      border: none;
      color: #ffffff;
      font-size: 1rem;
      margin: 6px 0;
      padding: 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, transform 0.2s;
      display: flex;
      align-items: center;
      gap: 8px; 
    }
    nav button:hover {
      background-color: rgba(255,255,255,0.15);
      transform: scale(1.02);
    }
    nav button.active {
      background-color: #007bff;
    }
    .nav-icon {
      width: 20px; 
      height: 20px;
    }


    section {
      flex: 1; 
      padding: 20px;
      overflow-y: auto;
      display: none;
      animation: fadeIn 0.4s ease, slideInUp 0.4s ease;
    }
    section.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }
    @keyframes slideInUp {
      from { transform: translateY(10px); }
      to   { transform: translateY(0); }
    }


    .form-group {
      margin-bottom: 1em;
      max-width: 600px;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.25em;
      font-weight: 600;
    }
    select, input[type="range"], input[type="text"], input[type="file"], textarea {
      width: 100%;
      border-radius: 4px;
      padding: 8px;
      border: 1px solid #444;
      background-color: rgba(255,255,255,0.07) !important;
      color: #fff;
      outline: none;
      -webkit-text-fill-color: #ffffff;
      appearance: none; 
      -webkit-appearance: none;
    }
    option {
      background-color: #222 !important;
      color: #fff !important;
    }


    button.primary {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
    }
    button.primary:hover {
      background-color: #005bb3; 
      transform: scale(1.05);
    }
    button.secondary {
      background-color: rgba(255,255,255,0.2);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      margin-left: 10px;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
    }
    button.secondary:hover {
      background-color: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }


    #status {
      margin-top: 20px;
      font-size: 1.1rem;
      min-height: 30px;
    }
    .monitor-buttons {
      display: flex;
      gap: 10px;
      margin: 1rem 0;
    }


    #advanced-custom-settings {
      display: none;
      background-color: rgba(255,255,255,0.03);
      border: 1px solid #333;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      animation: fadeIn 0.3s ease;
    }
    #advanced-custom-settings h4 {
      margin-top: 0; 
      font-size: 1.3rem; 
      text-transform: uppercase;
      font-weight: 700; 
      margin-bottom: 0.5rem;
      letter-spacing: 1px;
      text-align: center;
    }
    .adv-slider-group {
      margin-bottom: 1.2em;
    }
    .adv-slider-group label {
      font-weight: 500;
      margin-bottom: 0.2em;
      display: block;
    }
    .adv-slider-group input[type="range"] {
      width: 100%;
    }
    .slider-value {
      display: inline-block;
      min-width: 40px;
      text-align: right;
      margin-left: 10px;
      font-size: 0.9rem;
      opacity: 0.8;
    }

 
    #analyzer-canvas {
      display: block;
      width: 100%;
      max-width: 600px;
      height: 150px;
      background: #222;
      margin-top: 15px;
      border: 1px solid #444;
      border-radius: 4px;
    }

    .soundpad-container {
      margin-top: 20px;
    }
    .soundpad-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .sound-card {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 10px;
      transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .sound-card:hover {
      background-color: rgba(255,255,255,0.1);
      transform: scale(1.02);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .sound-card-header {
      display: flex; 
      align-items: center; 
      gap: 10px;
      margin-bottom: 10px;
    }
    .sound-card-header img {
      max-width: 64px; 
      max-height: 64px;
    }
    .sound-card-title {
      font-weight: 600;
      font-size: 1.1rem;
    }
    .sound-card-desc {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 10px;
    }
    .sound-card-buttons {
      margin-top: auto; 
      display: flex; 
      gap: 6px;
    }
    .btn-icon {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    #add-sound-form {
      display: none;
      padding: 15px;
      background-color: rgba(255,255,255,0.05);
      border-radius: 8px;
      border: 1px solid #333;
      max-width: 600px;
      animation: fadeIn 0.3s ease;
    }
    #add-sound-form.active {
      display: block;
    }
    #add-sound-form h3 {
      margin-top: 0;
      margin-bottom: 0.5em;
    }
    .preview-img {
      margin-top: 5px;
      max-width: 100px;
      max-height: 100px;
      border: 1px solid #444;
      border-radius: 4px;
    }

    
    .settings-section {
      max-width: 600px;
    }
    #status-message {
      margin-top: 1rem; 
      font-style: italic;
    }



  </style>
</head>

<body class="dark"> 

 
  <div id="offline-indicator">
    <img src="icons/offline.png" alt="Offline" title="Offline mód!"/>
  </div>


  <div id="intro-overlay">
    <div id="intro-text">SoundR</div>
  </div>

  <header>
    <h3 id="header-title">SoundR</h3>
    <button id="support-btn">
      <img
        src="icons/support.png"
        alt="support"
        width="24"
        height="24"
      />
      <span id="btn-support-text">Support</span>
    </button>
    <button id="discord-btn">
      <img
        src="icons/Discord.png"
        alt="Discord"
        width="24"
        height="24"
      />
      <span id="btn-discord-text">Discord</span>
    </button>
  </header>

  <main>
    <nav>
      <button id="nav-distortion" class="active">
        <img class="nav-icon" 
             src="assets/icons/distortion.png" 
             alt="torzító">
        Hangtorzító
      </button>
      <button id="nav-soundpad">
        <img class="nav-icon" 
             src="assets/icons/soundpad.png"
             alt="soundpad">
        Soundpad
      </button>
      <button id="nav-settings">
        <img class="nav-icon"
             src="assets/icons/settings.png"
             alt="beállítások">
        Beállítások
      </button>
    </nav>

 
    <section id="distortion-section" class="active">
      <h2 id="distortion-title">Hangtorzító</h2>

      <div class="form-group">
        <label id="distortion-label-type" for="distortion-type">Torzítás típusa:</label>
        <select id="distortion-type">
          <option value="robot">Robot hang</option>
          <option value="deep">Mély hang (pitch shift)</option>
          <option value="chipmunk">Chipmunk hang</option>
          <option value="chipmunk3">Alvin és a mókusok</option>
          <option value="alien">Alien hang</option>
          <option value="radio">Rádió hang</option>
          <option value="echo">Echo (Visszhang)</option>
          <option value="custom">Egyszerű WaveShaper (Egyéni)</option>
          <option value="advanced">Haladó (több effekt együtt)</option>
        </select>
      </div>

      <div class="form-group">
        <label id="distortion-label-input" for="audio-input">Mikrofon:</label>
        <select id="audio-input"></select>
      </div>

      <div class="form-group">
        <label id="distortion-label-output" for="audio-output">Hangkimeneti eszköz:</label>
        <select id="audio-output"></select>
      </div>


      <div id="custom-settings" class="form-group" style="display:none;">
        <h3>Egyszerű egyéni torzítás (WaveShaper)</h3>
        <label for="distortion-amount">Torzítás mértéke (1..500):</label>
        <input type="range" id="distortion-amount" min="1" max="500" value="250" />
      </div>


      <div id="advanced-custom-settings">
        <h4>Haladó beállítások (Realtime)</h4>

        <div class="adv-slider-group">
          <label for="adv-pitch-amount">Pitch shift (0.5 - 2.0):</label>
          <input type="range" id="adv-pitch-amount" min="0.5" max="2" step="0.01" value="1" />
          <span class="slider-value" id="adv-pitch-val">1</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-eq-low">Low gain (dB) [-20..+20]:</label>
          <input type="range" id="adv-eq-low" min="-20" max="20" step="1" value="0" />
          <span class="slider-value" id="adv-eq-low-val">0</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-eq-mid">Mid gain (dB) [-20..+20]:</label>
          <input type="range" id="adv-eq-mid" min="-20" max="20" step="1" value="0" />
          <span class="slider-value" id="adv-eq-mid-val">0</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-eq-high">High gain (dB) [-20..+20]:</label>
          <input type="range" id="adv-eq-high" min="-20" max="20" step="1" value="0" />
          <span class="slider-value" id="adv-eq-high-val">0</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-wave-amount">Torzítás (WaveShaper) [1..500]:</label>
          <input type="range" id="adv-wave-amount" min="1" max="500" value="250" />
          <span class="slider-value" id="adv-wave-val">250</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-delay-time">Delay/Echo (ms) [0..1000]:</label>
          <input type="range" id="adv-delay-time" min="0" max="1000" step="50" value="300" />
          <span class="slider-value" id="adv-delay-val">300</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-delay-feedback">Delay feedback (%) [0..95]:</label>
          <input type="range" id="adv-delay-feedback" min="0" max="95" step="5" value="40" />
          <span class="slider-value" id="adv-delay-feedback-val">40</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-ringmod-freq">Ring Mod freq (Hz) [0..1000]:</label>
          <input type="range" id="adv-ringmod-freq" min="0" max="1000" step="10" value="0" />
          <span class="slider-value" id="adv-ringmod-freq-val">0</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-noisegate-threshold">Noise Gate threshold (dB) [-100..0]:</label>
          <input type="range" id="adv-noisegate-threshold" min="-100" max="0" step="1" value="-50" />
          <span class="slider-value" id="adv-noisegate-threshold-val">-50</span>
        </div>
        <div class="adv-slider-group">
          <label for="adv-noisegate-ratio">Noise Gate ratio [1..20]:</label>
          <input type="range" id="adv-noisegate-ratio" min="1" max="20" step="1" value="4" />
          <span class="slider-value" id="adv-noisegate-ratio-val">4</span>
        </div>

        <canvas id="analyzer-canvas"></canvas>
      </div>

      <div class="form-group">
        <button id="apply-distortion" class="primary">Torzítás alkalmazása</button>
        <button id="disable-distortion" class="secondary">Torzítás kikapcsolása</button>
      </div>

      <div class="monitor-buttons">
        <button id="start-monitor" class="primary">Mikrofon monitor indítása</button>
        <button id="stop-monitor" class="secondary">Monitor leállítása</button>
      </div>

      <div id="status">
        <p>Torzítás állapota: <span id="status-text">Nincs aktiválva</span></p>
      </div>


      <div class="form-group" style="margin-top:2rem;">
        <h3>Hangprofilok</h3>
        <p>Elmentheted a torzítás beállításait, majd visszatöltheted.</p>
        <div style="display:flex; gap:1rem; margin-bottom:0.5rem;">
          <input type="text" id="voice-profile-name" placeholder="Profil neve" style="max-width:200px;"/>
          <button id="save-voice-profile" class="primary">Mentés</button>
        </div>
        <select id="voice-profile-select" style="max-width:300px;">
          <option value="">Válassz profilt...</option>
        </select>
        <button id="load-voice-profile" class="secondary">Betölt</button>
        <button id="delete-voice-profile" class="secondary">Töröl</button>
      </div>
    </section>


    <section id="soundpad-section">
      <h2 id="soundpad-title">Soundpad</h2>
      <p id="soundpad-desc">
        Itt két kimeneti eszközt választhatsz: egyet Preview-hez (csak te hallod), és egyet “Éles” (pl. VB-Cable).
        Illetve hozzáadhatsz egyedi hangokat.
      </p>

      <div class="form-group">
        <label for="soundpad-preview-output" id="soundpad-label-preview">Preview kimeneti eszköz:</label>
        <select id="soundpad-preview-output"></select>
      </div>
      <div class="form-group">
        <label for="soundpad-output" id="soundpad-label-output">Éles kimeneti eszköz:</label>
        <select id="soundpad-output"></select>
      </div>

      <button id="toggle-add-sound-btn" class="primary">Új hang hozzáadása</button>

      <div id="add-sound-form">
        <h3 id="add-sound-form-title">Új hang hozzáadása</h3>
        <div class="form-group">
          <label for="sound-title">Cím:</label>
          <input type="text" id="sound-title" placeholder="Pl. Vicces hang" maxlength="50" />
        </div>
        <div class="form-group">
          <label for="sound-desc">Leírás (max 200 karakter):</label>
          <textarea id="sound-desc" rows="3" maxlength="200" placeholder="Rövid leírás..."></textarea>
        </div>
        <div class="form-group">
          <label>Kép forrása:</label>
          <div>
            <label><input type="radio" name="imageSource" value="web" checked /> Web</label>
            <label style="margin-left: 1rem;"><input type="radio" name="imageSource" value="local" /> Lokális</label>
          </div>
          <div class="form-group" id="image-web-group">
            <label for="sound-img">Kép URL (web):</label>
            <input type="text" id="sound-img" placeholder="http://..." />
          </div>
          <div class="form-group" id="image-local-group" style="display:none;">
            <label for="sound-img-file">Kép feltöltése (lokális):</label>
            <input type="file" id="sound-img-file" accept="image/*" />
            <img id="img-preview" class="preview-img" alt="előnézet" />
          </div>
        </div>
        <div class="form-group">
          <label>Hang forrása:</label>
          <div>
            <label><input type="radio" name="soundSource" value="web" checked /> Web</label>
            <label style="margin-left: 1rem;"><input type="radio" name="soundSource" value="local" /> Lokális</label>
          </div>
          <div class="form-group" id="sound-web-group">
            <label for="sound-url">Hang URL (web):</label>
            <input type="text" id="sound-url" placeholder="http://..." />
          </div>
          <div class="form-group" id="sound-local-group" style="display:none;">
            <label for="sound-file">Hangfájl feltöltése:</label>
            <input type="file" id="sound-file" accept="audio/*" />
          </div>
        </div>
        <div class="form-group">
          <button id="save-sound-button" class="primary">Hozzáadás</button>
          <button id="cancel-edit-button" class="secondary" style="display:none;">Mégse</button>
        </div>
      </div>

      <div class="soundpad-container">
        <div class="soundpad-grid" id="soundpad-grid"></div>
      </div>
    </section>


    <section id="settings-section">
      <div class="settings-section">
        <h2 id="settings-title">Beállítások</h2>
        <p id="settings-desc">
          Itt lehet különböző beállításokat módosítani, amelyek localStorage-be elmentődnek.
        </p>

        <div class="form-group">
          <label id="label-language" for="language-select">Nyelv:</label>
          <select id="language-select">
            <option value="hu">Magyar</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
          </select>
        </div>

        <div class="form-group">
          <label id="label-theme" for="theme-select">Téma:</label>
          <select id="theme-select">
            <option value="dark">Sötét</option>
            <option value="light">Világos</option>
            <option value="auto">Automatikus</option>
          </select>
        </div>

        <div class="form-group">
          <label id="label-animations" for="animations-select">Animációk:</label>
          <select id="animations-select">
            <option value="on">Engedélyezve</option>
            <option value="off">Letiltva</option>
          </select>
        </div>

        <div class="form-group">
          <label id="label-volume" for="volume-range">Hangerő:</label>
          <input type="range" id="volume-range" min="0" max="100" value="50" />
        </div>

        <div class="form-group">
          <label id="label-auto-update" for="auto-update">Automatikus frissítés:</label>
          <select id="auto-update">
            <option value="off">Kikapcsolva</option>
            <option value="on">Bekapcsolva</option>
          </select>
        </div>

        <div class="form-group">
          <label id="label-discord-auto" for="discord-auto">Automatikus Discord csatlakozás:</label>
          <select id="discord-auto">
            <option value="off">Kikapcsolva</option>
            <option value="on">Bekapcsolva</option>
          </select>
        </div>

  
        <div class="form-group">
          <label for="custom-theme-select">Egyedi téma (CSS):</label>
          <select id="custom-theme-select">
            <option value="">Alapértelmezett</option>
          </select>
          <button id="apply-custom-theme" class="primary">Alkalmaz</button>
        </div>
        <div class="form-group">
          <label for="custom-theme-file">Új téma (.css fájl) hozzáadása:</label>
          <input type="file" id="custom-theme-file" accept=".css"/>
        </div>


        <div class="form-group">
          <label for="offline-mode-select">Offline mód:</label>
          <select id="offline-mode-select">
            <option value="auto">Auto (net állapot alapján)</option>
            <option value="on">Kényszerített Offline</option>
            <option value="off">Kényszerített Online</option>
          </select>
        </div>

        <button id="save-settings-btn" class="primary">Mentés</button>
        <div id="status-message"></div>
      </div>
    </section>
  </main>

  <script>

    const langStrings = {
      hu: {
        headerTitle: "SoundR",
        btnSupport: "Támogatás",
        btnDiscord: "Discord",
        navDistortion: "Hangtorzító",
        navSoundpad: "Soundpad",
        navSettings: "Beállítások",
        distortionTitle: "Hangtorzító",
        distortionLabelType: "Torzítás típusa:",
        distortionLabelInput: "Mikrofon:",
        distortionLabelOutput: "Hangkimeneti eszköz:",
        soundpadTitle: "Soundpad",
        soundpadDesc: "Válassz két kimenetet: egyet preview-hez, egyet éleshez. Egyedi hangokat is adhatsz hozzá.",
        soundpadLabelPreview: "Preview eszköz:",
        soundpadLabelOutput: "Éles eszköz:",
        settingsTitle: "Beállítások",
        settingsDesc: "Itt különböző beállításokat módosíthatsz, amik a localStorage-be mentődnek.",
        labelLang: "Nyelv:",
        labelTheme: "Téma:",
        labelAnimations: "Animációk:",
        labelVolume: "Hangerő:",
        labelAutoUpdate: "Automatikus frissítés:",
        labelDiscordAuto: "Automatikus Discord csatlakozás:",
        saveSettingsBtn: "Mentés",
        savedMsg: "Beállítások elmentve."
      },
      en: {
        headerTitle: "SoundR",
        btnSupport: "Support",
        btnDiscord: "Discord",
        navDistortion: "Distortion",
        navSoundpad: "Soundpad",
        navSettings: "Settings",
        distortionTitle: "Distortion",
        distortionLabelType: "Distortion type:",
        distortionLabelInput: "Microphone:",
        distortionLabelOutput: "Output device:",
        soundpadTitle: "Soundpad",
        soundpadDesc: "Select two outputs: one preview, one live. Add custom sounds too.",
        soundpadLabelPreview: "Preview device:",
        soundpadLabelOutput: "Live device:",
        settingsTitle: "Settings",
        settingsDesc: "Here you can tweak settings stored in localStorage.",
        labelLang: "Language:",
        labelTheme: "Theme:",
        labelAnimations: "Animations:",
        labelVolume: "Volume:",
        labelAutoUpdate: "Auto Update:",
        labelDiscordAuto: "Auto Discord Connect:",
        saveSettingsBtn: "Save",
        savedMsg: "Settings saved."
      },
      de: {
        headerTitle: "SoundR",
        btnSupport: "Unterstützen",
        btnDiscord: "Discord",
        navDistortion: "Verzerrer",
        navSoundpad: "Soundpad",
        navSettings: "Einstellungen",
        distortionTitle: "Verzerrer",
        distortionLabelType: "Verzerrungsart:",
        distortionLabelInput: "Mikrofon:",
        distortionLabelOutput: "Ausgabegerät:",
        soundpadTitle: "Soundpad",
        soundpadDesc: "Wähle zwei Ausgänge: Vorschau und Live. Eigene Sounds kannst du ebenfalls hinzufügen.",
        soundpadLabelPreview: "Vorschau-Gerät:",
        soundpadLabelOutput: "Live-Gerät:",
        settingsTitle: "Einstellungen",
        settingsDesc: "Hier kannst du verschiedene Einstellungen ändern, die in localStorage gespeichert werden.",
        labelLang: "Sprache:",
        labelTheme: "Thema:",
        labelAnimations: "Animationen:",
        labelVolume: "Lautstärke:",
        labelAutoUpdate: "Auto-Update:",
        labelDiscordAuto: "Auto. Discord-Verbindung:",
        saveSettingsBtn: "Speichern",
        savedMsg: "Einstellungen gespeichert."
      }
    };


    let appSettings = {
      language: 'hu',
      theme: 'dark',
      animations: 'on',
      volume: 50,
      autoUpdate: 'off',
      discordAuto: 'off',
      customThemeUrl: '',
      offlineMode: 'auto' // 'auto' | 'on' | 'off'
    };

    let customThemes = [];
    let voiceProfiles = [];
    let customSounds = [];


    function isActuallyOnline(){

      if(appSettings.offlineMode==='on'){
        return false;
      } else if(appSettings.offlineMode==='off'){
        return true;
      } else {
        return navigator.onLine;
      }
    }
    function updateOfflineUI(){
      const offline = !isActuallyOnline();
      if(offline){
        document.body.classList.add('offline');
      } else {
        document.body.classList.remove('offline');
      }

      const googleFontLink = document.getElementById('google-font-sixtyfour');
      if(!offline){
        googleFontLink.removeAttribute('disabled'); 
      } else {
        googleFontLink.setAttribute('disabled','disabled');
      }
    }
    window.addEventListener('online', ()=>{ 
      updateOfflineUI(); 
    });
    window.addEventListener('offline', ()=>{ 
      updateOfflineUI(); 
    });


    window.addEventListener('DOMContentLoaded', async () => {
     
      setTimeout(() => {
        const overlay = document.getElementById('intro-overlay');
        overlay.classList.add('hide');
        setTimeout(() => {
          overlay.style.display = 'none';
        }, 1000);
      }, 3500);

      loadSettings();
      loadCustomThemes();
      loadVoiceProfiles();
      applyAppSettings();  

      updateOfflineUI();    

      
      await fillRealDevices();

    
      loadCustomSoundsFromStorage();
      renderSoundpad();

      
      renderCustomThemeSelect();
      renderVoiceProfileSelect();

      initEventHandlers();
    });

 
    function initEventHandlers(){
     
      const distortionTypeSelect = document.getElementById('distortion-type');
      distortionTypeSelect.addEventListener('change', e => {
        const val=e.target.value;
        document.getElementById('custom-settings').style.display = (val==='custom') ? 'block' : 'none';
        document.getElementById('advanced-custom-settings').style.display = (val==='advanced') ? 'block' : 'none';
      });

      
      const applyDistortionBtn = document.getElementById('apply-distortion');
      const disableDistortionBtn = document.getElementById('disable-distortion');
      const statusText = document.getElementById('status-text');
      applyDistortionBtn.addEventListener('click', ()=>{
        statusText.textContent = 'Aktiválva';
      });
      disableDistortionBtn.addEventListener('click', ()=>{
        statusText.textContent = 'Nincs aktiválva';
      });

     
      let isMonitoring = false;
      document.getElementById('start-monitor').addEventListener('click', ()=>{
        if(!isMonitoring){
          isMonitoring = true;
          alert("Mikrofon monitorozás (demó). Itt valós AudioContext chain kellene.");
        }
      });
      document.getElementById('stop-monitor').addEventListener('click', ()=>{
        if(isMonitoring){
          isMonitoring = false;
          alert("Monitorozás leállítva.");
        }
      });

      
      const voiceProfileNameInput=document.getElementById('voice-profile-name');
      const voiceProfileSelect=document.getElementById('voice-profile-select');
      document.getElementById('save-voice-profile').addEventListener('click',()=>{
        let profName=voiceProfileNameInput.value.trim();
        if(!profName){ alert("Kérlek adj nevet a profilnak!"); return; }
        let distType = distortionTypeSelect.value;
        let newProfile={
          id:'vp_'+Date.now(),
          name:profName,
          distortionType: distType
        };
        voiceProfiles.push(newProfile);
        saveVoiceProfiles();
        renderVoiceProfileSelect();
        voiceProfileNameInput.value='';
        alert("Profil mentve: "+profName);
      });
      document.getElementById('load-voice-profile').addEventListener('click',()=>{
        let sel=voiceProfileSelect.value;
        if(!sel)return;
        let found=voiceProfiles.find(vp=>vp.id===sel);
        if(!found) return;
        distortionTypeSelect.value=found.distortionType || 'robot';
        document.getElementById('custom-settings').style.display = (found.distortionType==='custom') ? 'block' : 'none';
        document.getElementById('advanced-custom-settings').style.display = (found.distortionType==='advanced') ? 'block' : 'none';
        alert("Profil betöltve: "+found.name);
      });
      document.getElementById('delete-voice-profile').addEventListener('click',()=>{
        let sel=voiceProfileSelect.value;
        if(!sel)return;
        let idx=voiceProfiles.findIndex(vp=>vp.id===sel);
        if(idx<0)return;
        if(confirm("Biztos törlöd ezt a profilt?")){
          voiceProfiles.splice(idx,1);
          saveVoiceProfiles();
          renderVoiceProfileSelect();
        }
      });

     
      const navDistortionButton = document.getElementById('nav-distortion');
      const navSoundpadButton = document.getElementById('nav-soundpad');
      const navSettingsButton = document.getElementById('nav-settings');
      const distortionSection = document.getElementById('distortion-section');
      const soundpadSection = document.getElementById('soundpad-section');
      const settingsSection = document.getElementById('settings-section');

      navDistortionButton.addEventListener('click',()=>{
        navDistortionButton.classList.add('active');
        navSoundpadButton.classList.remove('active');
        navSettingsButton.classList.remove('active');
        distortionSection.classList.add('active');
        soundpadSection.classList.remove('active');
        settingsSection.classList.remove('active');
      });
      navSoundpadButton.addEventListener('click',()=>{
        navSoundpadButton.classList.add('active');
        navDistortionButton.classList.remove('active');
        navSettingsButton.classList.remove('active');
        soundpadSection.classList.add('active');
        distortionSection.classList.remove('active');
        settingsSection.classList.remove('active');
      });
      navSettingsButton.addEventListener('click',()=>{
        navSettingsButton.classList.add('active');
        navDistortionButton.classList.remove('active');
        navSoundpadButton.classList.remove('active');
        settingsSection.classList.add('active');
        distortionSection.classList.remove('active');
        soundpadSection.classList.remove('active');
      });

     
      const toggleAddSoundBtn = document.getElementById('toggle-add-sound-btn');
      const addSoundForm = document.getElementById('add-sound-form');
      const cancelEditButton = document.getElementById('cancel-edit-button');
      toggleAddSoundBtn.addEventListener('click',()=>{
        addSoundForm.classList.toggle('active');
        cancelEditButton.style.display='inline-block';
      });
      cancelEditButton.addEventListener('click',()=>{
        addSoundForm.classList.remove('active');
      });

      
      const imageSourceRadios = document.getElementsByName('imageSource');
      const imageWebGroup = document.getElementById('image-web-group');
      const imageLocalGroup = document.getElementById('image-local-group');
      imageSourceRadios.forEach(radio=>{
        radio.addEventListener('change', e=>{
          if(e.target.value==='web'){
            imageWebGroup.style.display='block';
            imageLocalGroup.style.display='none';
          } else {
            imageWebGroup.style.display='none';
            imageLocalGroup.style.display='block';
          }
        });
      });

      
      const soundSourceRadios = document.getElementsByName('soundSource');
      const soundWebGroup = document.getElementById('sound-web-group');
      const soundLocalGroup = document.getElementById('sound-local-group');
      soundSourceRadios.forEach(radio=>{
        radio.addEventListener('change', e=>{
          if(e.target.value==='web'){
            soundWebGroup.style.display='block';
            soundLocalGroup.style.display='none';
          } else {
            soundWebGroup.style.display='none';
            soundLocalGroup.style.display='block';
          }
        });
      });

      
      const soundImgFile = document.getElementById('sound-img-file');
      const imgPreview = document.getElementById('img-preview');
      soundImgFile.addEventListener('change', e=>{
        let file = e.target.files[0];
        if(!file) return;
        let reader = new FileReader();
        reader.onload = (ev)=>{
          imgPreview.src=ev.target.result;
        };
        reader.readAsDataURL(file);
      });

     
      document.getElementById('save-sound-button').addEventListener('click', ()=>{
        let title = document.getElementById('sound-title').value.trim();
        let desc = document.getElementById('sound-desc').value.trim();

        if(!title){
          alert("Adj nevet a hangnak!");
          return;
        }

       
        let selectedImgSource = [...imageSourceRadios].find(r=>r.checked).value;
        let finalImageUrl = '';
        if(selectedImgSource==='web'){
          finalImageUrl = document.getElementById('sound-img').value.trim();
        } else {
          if(imgPreview.src && !imgPreview.src.includes('placeholder')){
            finalImageUrl = imgPreview.src;
          }
        }

      
        let selectedSoundSource = [...soundSourceRadios].find(r=>r.checked).value;
        let finalSoundUrl = '';
        if(selectedSoundSource==='local'){
          let fileInput = document.getElementById('sound-file');
          let sFile = fileInput.files[0];
          if(!sFile){
            alert("Válassz hangfájlt, vagy állítsd át Web forrásra!");
            return;
          }
          let reader = new FileReader();
          reader.onload=(ev)=>{
            finalSoundUrl=ev.target.result;
            addNewSoundToCustomSounds(title, desc, finalImageUrl, finalSoundUrl);
            resetAddSoundForm();
          };
          reader.readAsDataURL(sFile);
        } else {
          finalSoundUrl = document.getElementById('sound-url').value.trim();
          if(!finalSoundUrl){
            alert("Adj meg érvényes hang URL-t!");
            return;
          }
          addNewSoundToCustomSounds(title, desc, finalImageUrl, finalSoundUrl);
          resetAddSoundForm();
        }
      });

      function resetAddSoundForm(){
        addSoundForm.classList.remove('active');
        document.getElementById('sound-title').value='';
        document.getElementById('sound-desc').value='';
        document.getElementById('sound-img').value='';
        imgPreview.src='';
        document.getElementById('sound-url').value='';
        document.getElementById('sound-file').value='';
      }

      
      const languageSelect=document.getElementById('language-select');
      const themeSelect=document.getElementById('theme-select');
      const animationsSelect=document.getElementById('animations-select');
      const volumeRange=document.getElementById('volume-range');
      const autoUpdateSelect=document.getElementById('auto-update');
      const discordAutoSelect=document.getElementById('discord-auto');
      const offlineModeSelect=document.getElementById('offline-mode-select');
      const saveSettingsBtn=document.getElementById('save-settings-btn');
      const statusMessage=document.getElementById('status-message');

      saveSettingsBtn.addEventListener('click', ()=>{
        appSettings.language=languageSelect.value;
        appSettings.theme=themeSelect.value;
        appSettings.animations=animationsSelect.value;
        appSettings.volume=parseInt(volumeRange.value);
        appSettings.autoUpdate=autoUpdateSelect.value;
        appSettings.discordAuto=discordAutoSelect.value;
        appSettings.offlineMode=offlineModeSelect.value;

        saveSettings();
        applyAppSettings();
        updateOfflineUI();

        statusMessage.textContent=(langStrings[appSettings.language]||langStrings.hu).savedMsg;
        setTimeout(()=>{statusMessage.textContent='';},2000);
      });

      
      const customThemeSelect=document.getElementById('custom-theme-select');
      const customThemeFileInput=document.getElementById('custom-theme-file');
      const applyThemeBtn=document.getElementById('apply-custom-theme');
      customThemeFileInput.addEventListener('change',(e)=>{
        let file=e.target.files[0];
        if(!file)return;
        let name=file.name.replace('.css','');
        let reader=new FileReader();
        reader.onload=(ev)=>{
          let content=ev.target.result;
          customThemes.push({name, url:content});
          saveCustomThemes();
          renderCustomThemeSelect();
          alert("Új téma hozzáadva: "+name);
        };
        reader.readAsDataURL(file);
      });
      applyThemeBtn.addEventListener('click',()=>{
        let sel=customThemeSelect.value;
        appSettings.customThemeUrl=sel;
        loadCustomCSS(sel);
        saveSettings();
      });

      
      document.getElementById('discord-btn').addEventListener('click',()=>{
        window.open('https://discord.gg/XnvMkUncSu','_blank');
      });
      document.getElementById('support-btn').addEventListener('click',()=>{
        alert('Támogatási lehetőségek: PayPal / Patreon / stb. (Demo)');
      });
    }


    function addNewSoundToCustomSounds(title, desc, imageUrl, soundUrl){
      let newSound={
        id:'cs_'+Date.now(),
        title, 
        desc, 
        imageUrl, 
        soundUrl
      };
      customSounds.push(newSound);
      saveCustomSoundsToStorage();
      renderSoundpad();
    }


    async function fillRealDevices(){
      try {
        const devices = await navigator.mediaDevices.enumerateDevices();

        const audioInputSelect = document.getElementById('audio-input');
        const audioOutputSelect = document.getElementById('audio-output');
        const spPreviewSelect = document.getElementById('soundpad-preview-output');
        const spOutputSelect = document.getElementById('soundpad-output');

        
        audioInputSelect.innerHTML='';
        audioOutputSelect.innerHTML='';
        spPreviewSelect.innerHTML='';
        spOutputSelect.innerHTML='';

        devices.forEach(device => {
          if(device.kind==='audioinput'){
            const opt=document.createElement('option');
            opt.value=device.deviceId;
            opt.textContent=device.label || 'Ismeretlen bemenet';
            audioInputSelect.appendChild(opt);
          } else if(device.kind==='audiooutput'){
            const opt=document.createElement('option');
            opt.value=device.deviceId;
            opt.textContent=device.label || 'Ismeretlen kimenet';
            audioOutputSelect.appendChild(opt);


            const opt1=document.createElement('option');
            opt1.value=device.deviceId;
            opt1.textContent=device.label || 'Ismeretlen kimenet';
            spPreviewSelect.appendChild(opt1);

            const opt2=document.createElement('option');
            opt2.value=device.deviceId;
            opt2.textContent=device.label || 'Ismeretlen kimenet';
            spOutputSelect.appendChild(opt2);
          }
        });

      } catch(err){
        console.error("Hangeszközök lekérése sikertelen:", err);
      }
    }


    function loadVoiceProfiles(){
      try {
        let stored = localStorage.getItem('soundrVoiceProfiles');
        if(stored){
          voiceProfiles = JSON.parse(stored);
        } else {
          voiceProfiles = [];
        }
      } catch(e) {
        voiceProfiles = [];
      }
    }
    function saveVoiceProfiles(){
      localStorage.setItem('soundrVoiceProfiles', JSON.stringify(voiceProfiles));
    }
    function renderVoiceProfileSelect(){
      const voiceProfileSelect = document.getElementById('voice-profile-select');
      voiceProfileSelect.innerHTML='';
      let defaultOpt=document.createElement('option');
      defaultOpt.value=''; 
      defaultOpt.textContent='Válassz profilt...';
      voiceProfileSelect.appendChild(defaultOpt);
      voiceProfiles.forEach(p=>{
        let opt=document.createElement('option');
        opt.value=p.id;
        opt.textContent=p.name;
        voiceProfileSelect.appendChild(opt);
      });
    }


    function loadCustomSoundsFromStorage(){
      try{
        let data = localStorage.getItem('soundrCustomSounds');
        if(data){
          customSounds = JSON.parse(data);
        } else {
          customSounds = [];
        }
      }catch(e){
        customSounds = [];
      }
    }
    function saveCustomSoundsToStorage(){
      localStorage.setItem('soundrCustomSounds', JSON.stringify(customSounds));
    }
    function renderSoundpad(){
      const grid = document.getElementById('soundpad-grid');
      grid.innerHTML = '';

      customSounds.forEach(sound => {
        let card = document.createElement('div');
        card.className = 'sound-card';

        let header = document.createElement('div');
        header.className = 'sound-card-header';

        let img = document.createElement('img');
        img.src = sound.imageUrl || 'https://via.placeholder.com/64';
        header.appendChild(img);

        let title = document.createElement('div');
        title.className = 'sound-card-title';
        title.textContent = sound.title;
        header.appendChild(title);

        card.appendChild(header);

        let desc = document.createElement('div');
        desc.className = 'sound-card-desc';
        desc.textContent = sound.desc;
        card.appendChild(desc);

        let btnContainer = document.createElement('div');
        btnContainer.className = 'sound-card-buttons';

        let btnPreview = document.createElement('button');
        btnPreview.className = 'secondary btn-icon';
        btnPreview.textContent = 'Preview';
        btnPreview.addEventListener('click', () => {
          alert('Lejátszás preview eszközön: ' + sound.title);
        });
        btnContainer.appendChild(btnPreview);

        let btnPlayLive = document.createElement('button');
        btnPlayLive.className = 'secondary btn-icon';
        btnPlayLive.textContent = 'Live';
        btnPlayLive.addEventListener('click', () => {
          alert('Lejátszás éles eszközön: ' + sound.title);
        });
        btnContainer.appendChild(btnPlayLive);

        card.appendChild(btnContainer);

        grid.appendChild(card);
      });
    }


    function loadSettings() {
      const data=localStorage.getItem('appSettings');
      if(data){
        let parsed=JSON.parse(data);
        Object.assign(appSettings, parsed);
      }
    }
    function saveSettings() {
      localStorage.setItem('appSettings', JSON.stringify(appSettings));
    }
    let customCssLink=null; 
    function loadCustomCSS(url){
      if(customCssLink){
        document.head.removeChild(customCssLink);
        customCssLink=null;
      }
      if(!url) return;
      customCssLink=document.createElement('link');
      customCssLink.rel='stylesheet';
      customCssLink.href=url;
      document.head.appendChild(customCssLink);
    }
    function applyAppSettings() {

      if(appSettings.theme==='auto'){
        const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
        if(prefersDark){
          document.body.classList.add('dark');
          document.body.classList.remove('light');
        } else {
          document.body.classList.add('light');
          document.body.classList.remove('dark');
        }
      } else if(appSettings.theme==='dark'){
        document.body.classList.add('dark');
        document.body.classList.remove('light');
      } else {
        document.body.classList.add('light');
        document.body.classList.remove('dark');
      }


      if(appSettings.animations==='off'){
        document.body.classList.add('animations-off');
      } else {
        document.body.classList.remove('animations-off');
      }


      if(appSettings.customThemeUrl){
        loadCustomCSS(appSettings.customThemeUrl);
      } else {

      }


      const L=langStrings[appSettings.language] || langStrings.hu;
      document.getElementById('header-title').textContent=L.headerTitle;
      document.getElementById('btn-support-text').textContent=L.btnSupport;
      document.getElementById('btn-discord-text').textContent=L.btnDiscord;

      document.getElementById('nav-distortion').innerHTML=`<img class="nav-icon" src="icons/distortion.png" alt="torzító"> ${L.navDistortion}`;
      document.getElementById('nav-soundpad').innerHTML=`<img class="nav-icon" src="icons/soundpad.png" alt="soundpad"> ${L.navSoundpad}`;
      document.getElementById('nav-settings').innerHTML=`<img class="nav-icon" src="icons/settings.png" alt="beállítások"> ${L.navSettings}`;

      document.getElementById('distortion-title').textContent=L.distortionTitle;
      document.getElementById('distortion-label-type').textContent=L.distortionLabelType;
      document.getElementById('distortion-label-input').textContent=L.distortionLabelInput;
      document.getElementById('distortion-label-output').textContent=L.distortionLabelOutput;

      document.getElementById('soundpad-title').textContent=L.soundpadTitle;
      document.getElementById('soundpad-desc').textContent=L.soundpadDesc;
      document.getElementById('soundpad-label-preview').textContent=L.soundpadLabelPreview;
      document.getElementById('soundpad-label-output').textContent=L.soundpadLabelOutput;

      document.getElementById('settings-title').textContent=L.settingsTitle;
      document.getElementById('settings-desc').textContent=L.settingsDesc;
      document.getElementById('label-language').textContent=L.labelLang;
      document.getElementById('label-theme').textContent=L.labelTheme;
      document.getElementById('label-animations').textContent=L.labelAnimations;
      document.getElementById('label-volume').textContent=L.labelVolume;
      document.getElementById('label-auto-update').textContent=L.labelAutoUpdate;
      document.getElementById('label-discord-auto').textContent=L.labelDiscordAuto;
      document.getElementById('save-settings-btn').textContent=L.saveSettingsBtn;
    }
    function renderCustomThemeSelect(){
      const customThemeSelect=document.getElementById('custom-theme-select');
      customThemeSelect.innerHTML='';
      let defaultOpt=document.createElement('option');
      defaultOpt.value='';
      defaultOpt.textContent='Alapértelmezett';
      customThemeSelect.appendChild(defaultOpt);
      customThemes.forEach(th=>{
        let opt=document.createElement('option');
        opt.value=th.url;
        opt.textContent=th.name;
        customThemeSelect.appendChild(opt);
      });
      if(appSettings.customThemeUrl){
        customThemeSelect.value=appSettings.customThemeUrl;
      }
    }
    function loadCustomThemes(){
      try{
        let c=localStorage.getItem('soundrCustomThemes');
        if(c) customThemes=JSON.parse(c);
        else customThemes=[];
      }catch(e){ customThemes=[];}
    }
    function saveCustomThemes(){
      localStorage.setItem('soundrCustomThemes',JSON.stringify(customThemes));
    }
  </script>
</body>
</html>
